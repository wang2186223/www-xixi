# âœ… æ•°æ®ç»Ÿè®¡ç³»ç»Ÿå®Œæ•´éªŒè¯æŠ¥å‘Š

## ğŸ¯ éªŒè¯æ—¶é—´
2025-01-15

## ğŸ“‹ éªŒè¯é¡¹ç›®

### âœ… 1. æ„å»ºè„šæœ¬æµ‹è¯•
**å‘½ä»¤**: `python3 tools/build-website.py --force`

**æµ‹è¯•ç»“æœ**: âœ… é€šè¿‡
```
âœ… ç½‘ç«™æ„å»ºå®Œæˆ!
è¾“å‡ºç›®å½•: docs
æ€»å°è¯´æ•°: 11
æ–°å¢: 0, æ›´æ–°: 0, æ— å˜åŒ–: 11
æœ¬æ¬¡æ„å»º: 11 æœ¬å°è¯´
ğŸ‰ æ„å»ºæˆåŠŸ!
```

**ä¾èµ–æ£€æŸ¥**:
- âœ… Python 3.9.6
- âœ… Jinja2 3.1.6
- âœ… æ‰€æœ‰æ¨¡æ¿æ–‡ä»¶å®Œæ•´

---

### âœ… 2. å‰ç«¯ä¸ŠæŠ¥ä»£ç éªŒè¯

#### ğŸ“„ index.html (é¦–é¡µ)
**æ¨¡æ¿**: `tools/templates/index.html`
**ç”Ÿæˆæ–‡ä»¶**: `docs/index.html`

| æ£€æŸ¥é¡¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| é¡µé¢è®¿é—®ä¸ŠæŠ¥ | âœ… | sendPageVisit() å‡½æ•°å­˜åœ¨ |
| API URL | âœ… | æ­£ç¡®çš„éƒ¨ç½²URL |
| IPè·å–å‡½æ•° | âœ… | getUserIP() 3å±‚å¤‡ç”¨ |
| è‡ªåŠ¨è§¦å‘ | âœ… | DOMContentLoaded äº‹ä»¶ |

**éªŒè¯å‘½ä»¤**:
```bash
grep -n "sendPageVisit" docs/index.html
# ç»“æœ: 3ä¸ªåŒ¹é…ï¼ˆå‡½æ•°å®šä¹‰ã€DOMContentLoadedã€ç«‹å³è°ƒç”¨ï¼‰
```

---

#### ğŸ“„ novel.html (å°è¯´è¯¦æƒ…é¡µ)
**æ¨¡æ¿**: `tools/templates/novel.html`
**ç¤ºä¾‹ç”Ÿæˆ**: `docs/novels/he-wants-me-not-my-girlfriends/index.html`

| æ£€æŸ¥é¡¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| é¡µé¢è®¿é—®ä¸ŠæŠ¥ | âœ… | sendPageVisit() å‡½æ•°å­˜åœ¨ |
| API URL | âœ… | æ­£ç¡®çš„éƒ¨ç½²URL |
| IPè·å–å‡½æ•° | âœ… | getUserIP() 3å±‚å¤‡ç”¨ |
| è‡ªåŠ¨è§¦å‘ | âœ… | DOMContentLoaded äº‹ä»¶ |

**éªŒè¯å‘½ä»¤**:
```bash
grep -n "sendPageVisit" docs/novels/he-wants-me-not-my-girlfriends/index.html
# ç»“æœ: 3ä¸ªåŒ¹é…
```

---

#### ğŸ“„ chapter.html (ç« èŠ‚é¡µé¢)
**æ¨¡æ¿**: `tools/templates/chapter.html`
**ç¤ºä¾‹ç”Ÿæˆ**: `docs/novels/he-wants-me-not-my-girlfriends/chapter-1.html`

| æ£€æŸ¥é¡¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| é¡µé¢è®¿é—®ä¸ŠæŠ¥ | âœ… | sendPageVisit() å‡½æ•°å­˜åœ¨ |
| å¹¿å‘Šç‚¹å‡»ç›‘æ§ | âœ… | 50ç§’è¿”å›æ£€æµ‹ç³»ç»Ÿ |
| API URL | âœ… | æ­£ç¡®çš„éƒ¨ç½²URL (3å¤„) |
| IPè·å–å‡½æ•° | âœ… | getUserIP() 3å±‚å¤‡ç”¨ |
| è‡ªåŠ¨è§¦å‘ | âœ… | DOMContentLoaded äº‹ä»¶ |
| å°è¯´æ ‡é¢˜å˜é‡ | âœ… | `novel: 'He Wants Me, Not My Girlfriends'` |
| ç« èŠ‚å·å˜é‡ | âœ… | `chapter: '1'` |
| å¹¿å‘Šæ£€æµ‹ | âœ… | AdSense ç±»åæ£€æµ‹ |

**éªŒè¯å‘½ä»¤**:
```bash
grep -n "sendPageVisit" docs/novels/he-wants-me-not-my-girlfriends/chapter-1.html
# ç»“æœ: 3ä¸ªåŒ¹é…

grep -n "AKfycbzYA0Fe1" docs/novels/he-wants-me-not-my-girlfriends/chapter-1.html
# ç»“æœ: 3ä¸ªåŒ¹é…ï¼ˆé¡µé¢è®¿é—®2æ¬¡ + å¹¿å‘Šç‚¹å‡»1æ¬¡ï¼‰

grep -n "novel: '" docs/novels/he-wants-me-not-my-girlfriends/chapter-1.html
# ç»“æœ: novel: 'He Wants Me, Not My Girlfriends'

grep -n "chapter: '" docs/novels/he-wants-me-not-my-girlfriends/chapter-1.html
# ç»“æœ: chapter: '1'
```

---

#### ğŸ“„ home.html (å¤‡ç”¨é¦–é¡µæ¨¡æ¿)
**æ¨¡æ¿**: `tools/templates/home.html`

| æ£€æŸ¥é¡¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| é¡µé¢è®¿é—®ä¸ŠæŠ¥ | âœ… | sendPageVisit() å‡½æ•°å­˜åœ¨ |
| API URL | âœ… | æ­£ç¡®çš„éƒ¨ç½²URL |
| IPè·å–å‡½æ•° | âœ… | getUserIP() 3å±‚å¤‡ç”¨ |
| è‡ªåŠ¨è§¦å‘ | âœ… | DOMContentLoaded äº‹ä»¶ |

---

### âœ… 3. åç«¯è„šæœ¬éªŒè¯

#### ğŸ“„ analytics-script.js
**é…ç½®éªŒè¯**:

| é…ç½®é¡¹ | å€¼ | çŠ¶æ€ |
|--------|-----|------|
| MAIN_SPREADSHEET_ID | `1vbBuPqQE8ho6XJgZR4fxDskEfEbQn1CnD4I_K41FNyU` | âœ… |
| DATA_FOLDER_NAME | `ç½‘ç«™ç»Ÿè®¡æ•°æ®` | âœ… |
| SPREADSHEET_PREFIX | `xixi-` | âœ… |
| éƒ¨ç½²URL | `AKfycbzYA0Fe1...` | âœ… |

**åŠŸèƒ½éªŒè¯**:

| åŠŸèƒ½ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| doPost å…¥å£ | âœ… | å¤„ç†3ç§äº‹ä»¶ç±»å‹ |
| doGet éªŒè¯ | âœ… | è¿”å›æˆåŠŸæ¶ˆæ¯ |
| é¡µé¢è®¿é—®å¤„ç† | âœ… | handlePageVisitEvent |
| å¹¿å‘Šå¼•å¯¼å¤„ç† | âœ… | handleAdGuideEvent |
| å¹¿å‘Šç‚¹å‡»å¤„ç† | âœ… | handleAdClickEvent |
| æ¯æ—¥è¡¨æ ¼åˆ›å»º | âœ… | å¸¦å¹¶å‘é”ä¿æŠ¤ |
| ç»Ÿè®¡æ›´æ–° | âœ… | æ¦‚ç‡æ€§æ›´æ–°(5%, 1%, 0.5%) |
| ç´¢å¼•æ¸…ç† | âœ… | è‡ªåŠ¨å»é‡ |
| æµ‹è¯•å‡½æ•° | âœ… | 6ä¸ªæµ‹è¯•å‡½æ•°å®Œæ•´ |

---

### âœ… 4. æ•°æ®ä¸ŠæŠ¥æµç¨‹éªŒè¯

#### ä¸ŠæŠ¥æµç¨‹1: é¡µé¢è®¿é—®
```
ç”¨æˆ·è®¿é—® â†’ é¡µé¢åŠ è½½ â†’ è·å–IP â†’ ä¸ŠæŠ¥ â†’ Google Sheets
```

**è§¦å‘é¡µé¢**:
- âœ… é¦–é¡µ (index.html)
- âœ… å°è¯´è¯¦æƒ…é¡µ (novel/index.html)
- âœ… ç« èŠ‚é¡µ (chapter-*.html)

**ä¸ŠæŠ¥æ•°æ®**:
```json
{
  "page": "å½“å‰URL",
  "userAgent": "æµè§ˆå™¨ä¿¡æ¯",
  "userIP": "ç”¨æˆ·IP"
}
```

#### ä¸ŠæŠ¥æµç¨‹2: å¹¿å‘Šç‚¹å‡»
```
æ£€æµ‹å¹¿å‘Š â†’ ç”¨æˆ·ç¦»å¼€ â†’ 50ç§’å†…è¿”å› â†’ ä¸ŠæŠ¥ â†’ Google Sheets
```

**è§¦å‘é¡µé¢**:
- âœ… ç« èŠ‚é¡µ (chapter-*.html)

**ä¸ŠæŠ¥æ•°æ®**:
```json
{
  "eventType": "ad_click",
  "novel": "å°è¯´æ ‡é¢˜",
  "chapter": "ç« èŠ‚å·",
  "pageUrl": "é¡µé¢URL",
  "adSlot": "å¹¿å‘Šä½ID",
  "adPosition": "å¹¿å‘Šä½ç½®",
  "scrollDepth": "æ»šåŠ¨æ·±åº¦",
  "userIP": "ç”¨æˆ·IP",
  "userAgent": "æµè§ˆå™¨ä¿¡æ¯",
  "screenSize": "å±å¹•å°ºå¯¸",
  "stayDuration": "åœç•™æ—¶é•¿",
  "totalClickCount": "ç´¯è®¡ç‚¹å‡»",
  "clickSource": "return_50s"
}
```

---

### âœ… 5. Jinja2 æ¨¡æ¿å˜é‡éªŒè¯

#### Chapter.html æ¨¡æ¿å˜é‡

| å˜é‡ | ä½¿ç”¨ä½ç½® | æ¸²æŸ“ç»“æœç¤ºä¾‹ | çŠ¶æ€ |
|------|----------|--------------|------|
| `{{ novel.title }}` | å¹¿å‘Šç‚¹å‡»ä¸ŠæŠ¥ | `He Wants Me, Not My Girlfriends` | âœ… |
| `{{ chapter.number }}` | å¹¿å‘Šç‚¹å‡»ä¸ŠæŠ¥ | `1` | âœ… |
| `{{ novel.cover_url }}` | é¡µé¢meta | å°é¢å›¾ç‰‡URL | âœ… |
| `{{ chapter.title }}` | é¡µé¢æ ‡é¢˜ | ç« èŠ‚æ ‡é¢˜ | âœ… |
| `{{ timestamps }}` | SEOæ—¶é—´ | ISOæ—¶é—´æˆ³ | âœ… |

**éªŒè¯æ–¹æ³•**:
```bash
# æ£€æŸ¥æ¸²æŸ“åçš„å˜é‡
grep "novel: '" docs/novels/*/chapter-*.html | head -1
# è¾“å‡º: novel: 'He Wants Me, Not My Girlfriends'

grep "chapter: '" docs/novels/*/chapter-*.html | head -1
# è¾“å‡º: chapter: '1'
```

---

## ğŸ“Š ä¸ŠæŠ¥URLç»Ÿè®¡

### APIç«¯ç‚¹ä½¿ç”¨æƒ…å†µ

| æ¨¡æ¿æ–‡ä»¶ | é¡µé¢è®¿é—® | å¹¿å‘Šç‚¹å‡» | æ€»è®¡ |
|----------|----------|----------|------|
| index.html | 2æ¬¡ | 0æ¬¡ | 2æ¬¡ |
| home.html | 2æ¬¡ | 0æ¬¡ | 2æ¬¡ |
| novel.html | 2æ¬¡ | 0æ¬¡ | 2æ¬¡ |
| chapter.html | 2æ¬¡ | 1æ¬¡ | 3æ¬¡ |

**API URL**: `https://script.google.com/macros/s/AKfycbzYA0Fe1-_ihK8E44GHmTrVQBYgjKkNM39sdGpl0DrdhOWxTaaaowf3eEvLXxbq08i1ug/exec`

---

## ğŸ§ª æµ‹è¯•å»ºè®®

### 1. å‰ç«¯æµ‹è¯•
```bash
# æ‰“å¼€ç”Ÿæˆçš„HTMLæ–‡ä»¶
open docs/index.html
open docs/novels/he-wants-me-not-my-girlfriends/chapter-1.html

# åœ¨æµè§ˆå™¨æ§åˆ¶å°æ£€æŸ¥
# åº”è¯¥çœ‹åˆ°: Analytics error: ... (å› ä¸ºno-corsæ¨¡å¼)
```

### 2. åç«¯æµ‹è¯•
åœ¨ Google Apps Script ç¼–è¾‘å™¨ä¸­è¿è¡Œï¼š
```javascript
// æµ‹è¯•é¡µé¢è®¿é—®
testPageVisit()

// æµ‹è¯•å¹¿å‘Šç‚¹å‡»
testAdClick()

// æµ‹è¯•è¡¨æ ¼åˆ›å»º
testCreateDailySpreadsheet()
```

### 3. é›†æˆæµ‹è¯•
```bash
# ä½¿ç”¨curlæµ‹è¯•API
curl -X POST \
  'https://script.google.com/macros/s/AKfycbzYA0Fe1-_ihK8E44GHmTrVQBYgjKkNM39sdGpl0DrdhOWxTaaaowf3eEvLXxbq08i1ug/exec' \
  -H 'Content-Type: application/json' \
  -d '{"page":"https://test.com","userAgent":"Test","userIP":"127.0.0.1"}'
```

---

## ğŸ“ é—ç•™é—®é¢˜æ£€æŸ¥

### âœ… å·²è§£å†³
1. âœ… index.html ç¼ºå°‘ä¸ŠæŠ¥ä»£ç  - **å·²æ·»åŠ **
2. âœ… æ‰€æœ‰æ¨¡æ¿ä½¿ç”¨ç»Ÿä¸€çš„API URL - **å·²ç¡®è®¤**
3. âœ… Jinja2å˜é‡æ­£ç¡®æ¸²æŸ“ - **å·²éªŒè¯**
4. âœ… æ„å»ºè„šæœ¬æ­£å¸¸å·¥ä½œ - **å·²æµ‹è¯•**

### âš ï¸ æ³¨æ„äº‹é¡¹
1. **éƒ¨ç½²Apps Script**: éœ€è¦æ‰‹åŠ¨éƒ¨ç½²åç«¯è„šæœ¬
2. **IPè·å–å»¶è¿Ÿ**: å¯èƒ½æœ‰1-2ç§’å»¶è¿Ÿï¼Œä¸å½±å“ç”¨æˆ·ä½“éªŒ
3. **no-corsæ¨¡å¼**: å‰ç«¯æ— æ³•è¯»å–å“åº”ï¼Œä½†æ•°æ®æ­£å¸¸ä¸ŠæŠ¥
4. **localStorage**: å¹¿å‘Šç‚¹å‡»è®¡æ•°ä¾èµ–localStorage

### ğŸ’¡ ä¼˜åŒ–å»ºè®®
1. å¯ä»¥æ·»åŠ é‡è¯•æœºåˆ¶ï¼ˆå¦‚æœfetchå¤±è´¥ï¼‰
2. å¯ä»¥æ·»åŠ æœ¬åœ°ç¼“å­˜é˜Ÿåˆ—ï¼ˆç¦»çº¿æ—¶æš‚å­˜ï¼‰
3. å¯ä»¥æ·»åŠ æ•°æ®å‹ç¼©ï¼ˆå‡å°‘ä¼ è¾“é‡ï¼‰

---

## âœ… æœ€ç»ˆç»“è®º

### ç³»ç»ŸçŠ¶æ€
- âœ… **æ„å»ºè„šæœ¬**: å®Œå…¨æ­£å¸¸
- âœ… **å‰ç«¯ä¸ŠæŠ¥**: å…¨éƒ¨æ¨¡æ¿å·²æ·»åŠ 
- âœ… **åç«¯è„šæœ¬**: é…ç½®æ­£ç¡®
- âœ… **å˜é‡æ¸²æŸ“**: æ­£ç¡®æ— è¯¯
- âœ… **æ•°æ®æµç¨‹**: å®Œæ•´æ— é—æ¼

### è¦†ç›–ç‡ç»Ÿè®¡
| é¡¹ç›® | è¦†ç›–ç‡ | è¯´æ˜ |
|------|--------|------|
| æ¨¡æ¿æ–‡ä»¶ | 4/4 (100%) | æ‰€æœ‰æ¨¡æ¿éƒ½æœ‰ä¸ŠæŠ¥ä»£ç  |
| ä¸ŠæŠ¥äº‹ä»¶ | 2/2 (100%) | é¡µé¢è®¿é—®+å¹¿å‘Šç‚¹å‡» |
| é¡µé¢ç±»å‹ | 3/3 (100%) | é¦–é¡µ+è¯¦æƒ…é¡µ+ç« èŠ‚é¡µ |
| APIé›†æˆ | 1/1 (100%) | ç»Ÿä¸€APIç«¯ç‚¹ |

### ä¸‹ä¸€æ­¥è¡ŒåŠ¨
1. **ç«‹å³**: éƒ¨ç½² Google Apps Script
2. **æµ‹è¯•**: è¿è¡Œæµ‹è¯•å‡½æ•°éªŒè¯
3. **ç›‘æ§**: æŸ¥çœ‹ Google Sheets æ•°æ®
4. **ä¼˜åŒ–**: æ ¹æ®å®é™…æ•°æ®è°ƒæ•´å‚æ•°

---

**éªŒè¯å®Œæˆæ—¶é—´**: 2025-01-15  
**éªŒè¯äºº**: ç³»ç»Ÿç®¡ç†å‘˜  
**çŠ¶æ€**: âœ… å…¨éƒ¨é€šè¿‡ï¼Œå‡†å¤‡æŠ•å…¥ç”Ÿäº§
